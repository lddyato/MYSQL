目录
+ [Summary](#Summary)
+ [ER 建模基本构建](#ER 建模基本构建)
+ [实体](#实体)



# Summary
<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014716458.png">

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014856564.png">

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014927482.png">

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014959826.png">


关系数据库模型是DBMS软件组成部分的基础。DBMS软件包用于实现目前大多数的操作型和分析型数据库。
关系DBMS软件包括Oracle、MySQL、Microsoft SQL Server、PostgreSQL、IBM DB2以及Teradata。
在这些DBMS工具中，Teradata适用于大型分析型数据库，其他的DBMS可同时用于操作型数据库和分析型数据库。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618022140928.png">

# ER 建模基本构建
ER建模后得到的ER图（ER diagram，ERD）是整个数据库的蓝图。实体(entity)和联系(relationship)是ER图的两个基本构件。目前还没有一个所有数据库都遵循的通用ER符号体系。相反，当前采用的ER符号体系种类繁多。虽然采用来自不同符号体系的ER符号来表示实体和联系时差异巨大，但其含义通常是相同的。

# 实体
实体是ER图的基本组件，用于描述数据库所记录的内容。实体可以表示现实世界中的众多概念，如人、地点、对象、事件、项目等。例如，一个零售公司的ER图可能包含顾客（CUSTOMER）、商店（STORE）、产品（PRODUCT）和交易额（SALES TRANSACTION）四个实体。
 
ER图用矩形代表实体，实体名写在矩形里面，同一个ER图中的不同实体应该有不同名字。图2-1展示了CUSTOMER及STORE两个实体的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618034900418.png">

图2-1中每个实体包含多个实体实例/实体成员（entity instance/entity member），如实体CUSTOMER可能包含Joe、Sue、Pat等实例。实体本身需要画在ER图中，实体实例虽然不需要表示在ER图中，但会被记录到根据该ER图所创建的数据库之中

# 属性(唯一和非唯一)
ER图中每个实体都有属性，实体的一个属性描述该实体的一种特征。由于实体表示的是数据库所记录内容的组件，因而实体属性表示每个实例需要记录的细节。例如，对实体CUSTOMER可以记录以下属性：编号（CustID）、姓名（CustName）、生日（CustBDate）、性别（CustGender）。图2-2描述了如何将属性填入ER图中：每个属性由一个写有属性名字的椭圆表示，同一个实体的不同属性名字不同，每个椭圆用一条线连接到相应实体。唯一属性（unique attribute）是指可以唯一标识实体实例的属性。通常来说一个实体至少要有一个唯一属性。如图2-2所示，ER图中实体的唯一属性都带有下划线。该图所示的数据库需求表明，每个顾客的编号必须唯一，但两个或多个顾客的生日、姓名或性别则可以相同。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035422489.png">

# 联系
ER图中每个实体必须通过联系至少与一个其他实体相关联。在ER图中联系表示为一个菱形，菱形中间写有代表联系名字的词或短语，菱形与所有参与该联系的实体进行连线。

## 基数约束 Cardinality Constraint
ER图中，在实体与联系的连线上往往写有一些符号，这些符号就是基数约束（cardinality constraint）。基数约束用于表示该实体可以有多少实例与另一实体的实例存在联系。考虑图2-3中的ER图，菱形“ReportsTo”表示实体EMPLOYEE和实体DEPARTMENT之间的联系。而表示基数约束的符号则常常写于实体和联系之间靠近实体一端的连线上。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035234234.png">

每个基数约束包含以下两个部分：
* 最大基数（maximum cardinality）——靠近实体一端的基数约束部分；
* 最小基数/参与（minimum cardinality/participation）——远离实体一端的基数约束部分。
* 最大基数可以是一个（表示为“|”）或多个（表示为“?”）。
* 最小基数可以是可选的（表示为“0”）或者是强制的（表示为“|”）。

图2-4列出了实体A与联系B之间所有四种可能的基数约束。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035259565.png">

接下来将以图2-3中包含关系ReprotsTo的ER图为例说明基数约束的概念。以下是
图2-3中ER图的基本需求：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035325223.png">

1. 数据库将记录职员（employee）和部门（department）信息。
1. 对每个职员记录其姓名及唯一职员编号（employeeID）。
1. 对每个部门记录其唯一部门编号（departmentID）和位置。
1. 每个职员必须且只能为一个部门作报告。一个部门可以有许多职员为其报告，但也可以没有任何职员。

首先考虑图2-3中ReprotsTo菱形右侧的基数约束符号“||”。强制参与符号（本例中的左侧竖线）表示每个职员必须至少为一个部门作报告。换言之，关系ReortsTo的EMPLOYEE实体的最大基数约束是1。最大基数约束符号一个（本例中的右侧竖线）表示每个职员至多可以为一个部门作报告。因此，这两个符号放在一起，表示每个职员必须且只能为一个部门作报告。

接下来考虑ReportsTo菱形左侧的基数约束符号“?0”。可选参与符号（0）表示部门可以没有职员来作报告，换言之，ReportsTo关系中的DEPARTMENT实体的最小基数约束是0，最大基数约束多个（?）表示一个部门可能有多个职员来作报告。因此，这两个符号放在一起表示每个部门可以有多个职员来作报告，但也可以没有。换言之，一个部门最少有0个职员，最多有多个职员。
 
注意，解释ER图中联系的合理方法，是利用**矩形–菱形–基数约束–矩形**规则分别**从相反方向分两次**来考虑这个关系。例如，联系ReportsTo就可以解释成：
 
* 一个方向：**矩形（职员）–菱形（作报告）–基数约束（有且仅有一个）–矩形（部门）**；
 
* 另一个方向：**矩形（部门）–菱形（接受报告）–基数约束（从0到多个）–矩形（职员）**。
 
为进一步重申关系和基数约束的概念，本书接下来将在图2-5中给出ReportsTo联系的几种可能版本（为简洁起见，省略了实体属性）。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035325223.png">

以下是每个版本的需求:
* 版本A：每个职员必须且只能为一个部门作报告。一个部门可能同时有多个职员作报告，也可能没有。
* 版本B：一个职员可以为一个或者不为任何部门作报告。一个部门可以同时有多个职员作报告，也可能没有任何职员。
* 版本C：每个职员必须且只能为一个部门作报告。一个部门必须有至少一个职员作报告，也可以同时有多个职员。
* 版本D：一个职员可以为一个或者不为任何部门作报告。一个部门必须有至少一个职员作报告，也可以同时有多个职员。

# 联系类型（最大基数侧）
联系两侧的最大基数约束可为一个或者多个。因此，若不考虑最小基数而仅考虑最大基数，则联系共有以下几种情况：
 
* 一对一联系（1∶1）
* 一对多联系（1∶M)
* 多对多联系（M∶N)
图2-6给出了这三种类型的联系及其最大基数侧（由于最小基数不影响最大基数，为简明起见，将其省略）。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035532647.png">

图2-3和2-5给出了1∶M联系的例子。图2-7的例子同样也是1∶M联系，该联系反映了如下需求：
 
每个商店（store）必须且只能位于一个区域（region）。每个区域内至少要有一个商店，当然也可以有多个商店。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035551529.png">

图2-8给出了一个M∶N联系的例子，反映的需求如下：
 
一个职员（employee）可能分配了多个项目（project），但也可能一个项目也没有。一个项目至少应分配给一个职员，当然也可以分给多个职员共同完成。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035615931.png">

图2-9给出了一个1∶1联系，反映的需求如下：
 
每个职员（employee）要么分有一辆车（vehicle），要么一辆也没有。每辆车必须且只能分给一个职员。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035636846.png">

# 联系和联系实例
每个实体都有自己的实例，如实体EMPLOYEE可能有实例Bob、Lisa、Maria等。实体本身需要画在ER图中，实体实例虽然不需要表示在ER图中，但会被记录到根据该ER图所创建的数据库之中。与此类似，联系也有自己的实例。图2-10给出了一个联系及其实例的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035739547.png">

如图2-10所示，当一个实体的实例通过联系与另一个实体的实例相关联时，一个联系实例就产生了。就像实体和实体实例的情况一样，联系本身会被画进ER图，联系实例则不需要表示在ER图中，但会被记录到根据该ER图所创建的数据库中。
 
注意，图2-10中的实体EMPLOYEE在联系AssignedTo中为可选参与，所以才可能存在职员（如Matt）与右边所有项目都不相连的情况。而由于PROJECE实体在联系AssignedTo中为强制参与，因此每一个PROJECT的实例都必须至少与一个EMPLOYEE实体的实例存在连线。

# 联系属性
在许多情况下，多对多联系有自己的属性，这些属性就是联系属性（relationship attributes）。图2-11给出了一个例子，该ER图的需求如下：
1. 数据库将记录学生（students）和校园组织（campus organizations）信息。
1. 对每个学生记录其唯一学号（student ID）、姓名（name）及性别（gender）。
1. 对每个校园组织记录其唯一组织编号（organization ID）和位置（location）。
1. 数据库中每个学生必须至少属于一个校园组织，也可以同时属于多个组织。
1. 数据库中每个校园组织至少有一个学生加入其中，也可以同时拥有多个学生。
1. 对属于某个校园组织的每个具体的学生实例，记录该学生在该校园组织中的职能（function）（如主席、副主席、会计、成员等）。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035902659.png">

上面的最后一条需求表明，一个学生在不同的校园组织中可以有多个不同的职能。若将职能作为实体STUDENT的一个或多个属性，则无法知道某个职能是该学生在哪个社会组织中的职能。若将职能作为ORGANIZATION的一个或多个属性，又无法知道该社会组织的某职能具体由哪个学生来担任。因此，如图2-11所示，职能属性唯一恰当的位置是作为BelongsTo联系的属性。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035923173.png">

接下来讨论1∶1联系与1∶M联系是否也可以拥有属性。为了回答这个问题，图2-12给出了两个有细微差别的ER图，这两个图的需求如下：
 
1. 数据库记录学生（student）和学院（college）信息。
1. 对每个学生记录其姓名和唯一学号（student ID）。
1. 对每个学院记录其唯一名称（name）和位置（location）。
1. 每个学生必须且只能加入一个学院。
1. 每个学院有多个学生。
1. 对每个学生记录其注册进入学院的日期。
 
图2-12的上半部分给出了1∶M联系的一个属性。下半部分基于同样的需求，但将学生的注册日期作为实体STUDENT的属性StudentCollSdate，而不是作为联系Attends的属性DateStarted。由于一个学生只能加入一个学院，因此该学生加入该学院的日期可以作为STUDENT实体本身的一个属性。如本例所述，1∶M联系的一个属性可转化为在该联系中最大基数为1的实体属性（本例中的STUDENT）。**更一般地讲，联系属性可以转化为在该联系中最大基数为1的实体属性**。因此，**1∶M联系或1∶1联系的属性都不是必要的。**相反，如图2-11所示，对一些M∶N联系来说，属性则是必要的。

# 实例：数据库需求集及其ER图
下面这些与零售相关的实例都是数据库需求及其对应ER图的例子。
 
ZAGI零售公司的销售部门准备创建一个数据库来记录销售过程的细节。在访问公司并学习了公司文件以后，数据库团队抽取出了如下需求。
 
ZAGI零售公司销售部门数据库将收集如下数据：
 
* 对每个在售产品（product）：产品号(product ID)（唯一）、产品名称（product name）、价格（price）；
* 对每个种类（category）：种类号（category ID）（唯一）、种类名称（category name）；
* 对每个自动售货机（vendor）：售货机号（vendor ID）（唯一）、售货机名称（vendor name）；
* 对每位顾客（customer）：顾客号（customer ID）（唯一）、姓名（name）、邮政编码（zip code）；
* 对每个商店（store）：商店号（store ID）（唯一）、邮政编码（zip code）；
* 对每个区域（region）：区域号（region ID）（唯一）、区域名称（region name）；
* 对每项销售交易（sales transaction）：交易号（transaction ID）（唯一）、交易时间（date of transaction）。
1. 每个产品必须且只能由一个售货机供应；
1. 每个售货机可以包含一个或多个产品。
1. 每个产品必须且只能属于一个种类；
1. 每个种类可以包含一个或多个产品。
1. 每个商店必须且只能位于一个区域；
1. 每个区域可以包含一个或多个商店。
1. 每项销售交易只能出现在一个商店中；
1. 每个商店可以有一项或多项销售交易发生。
1. 每项销售交易必须且只能跟一位顾客相关；
1. 每位顾客可以与一项或多项销售交易相关。
1. 每个产品可以通过一项或多项销售交易售出；
1. 每项销售交易可以包含一个或多个产品。
1. 对于每个通过销售交易售出的产品实例，记录其售出的数量。
2. 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041003396.png"> 

图2-13给出了基于以上需求得到的ER图。注意，ER符号体系的知识，能够为数据库需求收集人员获得结构化的、有用的需求提供帮助。换言之， ER图的构建必须以完成数据库需求搜集过程为基础，认清这一点可以帮助数据库需求收集人员提出恰当的问题。下面列出了几个相应问题的例子（来自图2-13中ER图的需求搜集过程）：
 
对一位顾客，你最想记录什么信息？（顾客号、姓名及邮政编码）
每位顾客的顾客号是否唯一？（是的）
每位顾客的姓名是否唯一？（不是）
一个产品属于一个种类还是多个？（一个）
一个产品是否只能来自一个售货机？（是的）
是否曾经有过某售货机不提供任何产品的情况？（没有）
是否需要记录那些到目前为止没有买过任何商品的顾客（那些没有参与任何销售交易的顾客）？（不需要）

# 复合属性 Composite Attribute

除前文中提到的常规属性外，ER图还可以描述几种其他属性，复合属性（composite attribute）就是其中的一种。复合属性是若干属性的组合，图2-14就给出了一个复合属性的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041125811.png">

在图2-14中，属性CustFullName（顾客全名）由两个部分组成：属性CustFName（顾客名字）和属性CustLName（顾客姓氏）。复合属性用于表示由若干单个属性组成的属性集合拥有新含义的情况。在图2-14中，实体CUSTOMER有5个属性：编号（CustID）（描述顾客信息的唯一标识号）、性别（CustGender）、生日（CustBdate）、名字（CustFName）、姓氏（CustLName）。全名并不是实体CUSTOMER的额外属性，相反，它仅仅表示将名字和姓氏结合起来以后所得到的完整的顾客姓名。
 
图2-15给出了另一个复合属性的例子。实体STORE共有6个属性，每个属性都有自己的意义。若将属性街道（Street）、编号（StreetNumber）、城市（City）、州（State）、邮编（Zip）放在一起考虑，则可得到一个新的含义：商店地址（Store Address）。
 
图2-16给出了包含7个属性的BOUTIQUECLIENT实体的例子。这家独具一格的裁缝店记录了每位顾客的尺寸信息及顾客的名字（firstname）。同时，该裁缝店还记录了顾客的5种穿衣指数：腿长（inseam）、腰围（waist）、袖长（sleeves）、肩宽（shoulders）以及领围（collar）。这个例子说明一个简单属性可能是多个复合属性的组成部分。腿长及腰围可组成属性裤子尺寸（pantsize），而腰围、肩宽、领围及袖长可组成属性衬衣尺寸（shirtsize）。
 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041151368.png">

# 复合的唯一属性
图2-17给出了拥有复合的唯一属性（composite unique attribute）的实体例子。在图2-17中，教学楼（Building）、房间号（Room Number）、座位数（Number of seats）是实体CLASSROOM的三个属性，但它们都不唯一。CLASSROOM实体的需求表示如下：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041258877.png">

1. 同一栋教学楼中可以有多个教室（如A教学楼中有若干个教室）。
1. 可以有多个教室拥有相同的房间号（如A教学楼的111房间与B教学楼的 111房间）。
1. 可以有多个教室拥有相同的座位数（如若干个教室都有40个座位）。
 
由于三个属性都不唯一，所以CLASSROOM没有一个可以唯一标识其本身的简单属性（single-component）。然而教学楼和房间号两个属性的结合却是唯一的（因为在整个数据库中，给定教学楼和房间号可以确定唯一教室），因此，这两个属性组成的复合属性可以作为唯一属性。
 
复合属性ClassroomID使得实体CLASSROOM符合每个实体至少要有一个唯一属性的规则。

# 多个唯一属性（候选码）
图2-18给出的实体同时拥有多个唯一属性，这里的每个唯一属性就叫做一个候选码（candidate key）。“候选”的意义在于：这些属性都可作为构建整个数据库时主要区别属性（或称主码）的备选。换言之，这些候选码中的一个会成为表中该实体的主码。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041403640.png"> 

在图2-18中，属性EmpID和SSN都可以区分一个EMPLOYEE实体，因此两者都是EMPLOYEE的候选码。所有候选码都有下划线标识。属性薪水（Salary）并不唯一，因此不是候选码。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041431736.png">
 
一个实体可以同时将常规属性（单个复合属性）或复合属性作为主码。图2-19中，实体VEHICLE的属性VIN（vehicle identification number）是唯一的，同样，State和LPNumber组合起来的复合属性LPlate也是唯一的。

# 多值属性 multivalued attribute
多值属性（multivalued attribute）用于实体实例的同一属性可以有多个不同取值的情况。图2-20给出了一个有多值属性的实体例子，标识多值属性的椭圆外画有双线。图2-20中的ER图需要记录用户的多个电话号码。
 
多值属性用于那些属性取值多于一个的实体，图2-20就是这样的情景：对于每个职员，需要记录若干个联系电话。例如，某职员可能有两个联系电话，而有些职员可能有多于两个的联系电话，或是少于两个的联系电话。
 
如图2-21所示，若对每个职员都记录两个联系电话（办公室电话和手机），则不需要使用多值属性，只要分别使用两个单值属性就可以了。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041530661.png">

# 派生属性(Devires Attribute)

派生属性（derives attribute）是非永久性存于数据库的属性。派生属性的值可以从别的属性值或其他数据（如当前日期）派生出来。图2-22给出了一个从ER模型中得到派生属性的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041701341.png">
 
派生属性用虚线的椭圆标识，属性Opening-Date作为一个常规属性会存于最终的数据库中，YearsInBusiness作为一个派生属性则不会存于数据库中，而是从商店的OpeningDate及当前日期中派生出来。如果YearsInBusiness是一个常规属性，其值将存于数据库中且需要人工更新（一般每年一次），否则数据库中将出现错误信息。而将YearsInBusiness作为派生属性后，就可以确保数据库以后将该属性作为一个公式，用于得到正确的当前YearsInBusiness的属性值。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041630588.png"> 

图2-23给出了另一个派生属性的例子。在本例中，对与REGION的实例有IsLocatedIn联系的STORE实例进行计数，就可以得出派生属性NoOfStores的值。   
在本例中，属性NoOfStores在东区（East）、中心区（Central）、西区（West）的值分别为1、2、1。如果实体STORE有了一个新的实例StoreE，且该实例通过新的IsLocatedIn联系实例与REGION实例West相关，则西区（West）的派生属性NoOfStores会自动地从1增加为2。

# 可选属性(Optional Attribute)
对每个实例，实体的大部分属性都有相应的取值，但有的属性也可能没有取值，这些属性就是可选属性（optional attribute）。图2-24给出了一个可选属性的例子，表示了如下需求：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041804862.png">
 
对每个职员记录其唯一的编号（employee ID）及其薪水（salary）和年终奖（annual bonus）。但并非所有职员都有年终奖（annual bonus）。
 
图中的实体只有一个可选属性，其他属性均为必需属性。我们在属性名后加一个带括号的大写字母O来表示可选属性。

# 实例：包含多种类型属性的实体
图2-25展示了一个包含多种类型属性的实体。该实体反映了以下需求：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042114253.png">

* 数据库将记录雇员信息。
 
对于每一名雇员，将记录以下属性：雇员的唯一ID、唯一的e-mail、姓、名（姓和名可以组合成完整的姓名）、多个电话号码、出生日期、年龄（通过出生日期和当前日期计算）、工资、奖金（可选）、多种技能、唯一的社会保险号码、雇员首次被雇佣的日期以及雇员在该公司的工作年限（通过雇员首次被雇佣的日期和当前日期计算）。

# 联系中最小基数和最大基数确切值
在某些情况下，联系中的最小基数和最大基数确切值（exact minimum and/or maximum cardinality）是事先知道的。在本书中，我们用圆括号括起来的一对数表示最小基数和最大基数，括号内的第一个数表示最小基数，第二个数表示最大基数。根据事先知道的最小基数和最大基数的信息，这些数对可以出现在联系的任意一边或者两边。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042257644.png">

如图2-26所示，对于联系EnrollsIN，需求如下：
* 每名学生必须选择最少2门最多6门课程，且一门课程要有最少5名最多40名学生。
 
具体的最大基数和最小基数是用菱形符号和基数约束符号之间的数对表示的。
 
本书中，当需要用圆括号括起来的数对表示最小和最大基数时，即使它们中的一个是不确定的值，我们仍需要将两个值（最小值和最大值）都表示出来。如图2-27所示，对于联系EnrollsIN，需求如下：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042319122.png">

* 每名学生最多选择6门课程，也可以不选任何课程。一门课程必须要有至少5名学生，选课人数没有上限。
在这个例子中，通过两种方式表明实体STUDENT可选地参与到联系EnrollsIn中：一种是使用最小基数的可选参与符号；另一种是通过联系符号与基数约束符号之间的数对说明最小约束为0。同样，实体CLASS的最大基数（多个但没有确定值）也是通过两种方式来说明的：一种是通过鸭掌符号（?）说明最大基数；另一种是通过数对中的字母M表明最大基数。

# 一元联系和联系的角色
联系的度（degree of a relationship）表示有多少个实体参与到该联系中。目前为止，本书所涉及的联系都只涉及两个实体。两个实体之间的联系叫做二元联系（binary relationship）或者度为2的联系（因为该联系涉及两个实体）。尽管绝大多数业务ER图中的联系都是二元联系，但是也会出现度不为2的联系。度为1的联系也称为一元联系（unary relationship）或者递归联系（recursive relationship），出现在一个实体与它自己相联系的情况中。图2-28展示了三个一元联系的例子，分别是1∶N、M∶N和1∶1三种情况。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042501193.png">

* 图2-28中，例B的需求如下：一个客户可以推荐多个客户，也可以不推荐任何客户。每个客户可以由另一个客户推荐或者没有被任何客户推荐。
* 图2-28中，例B的需求如下：一个雇员可以指导许多雇员，也可以不指导任何雇员。一个雇员可以被多个雇员指导，也可以不被任何雇员指导。
* 图2-28中，例C的需求如下：在一个赠送礼物活动数据库中（神秘圣诞老人），每个人只能向另一个人赠送礼物，每个人也只能收到另一个人的礼物。
 
在ER图中，联系角色（relationship role）可以表达额外的语义信息。数据建模者可以使用联系角色进一步说明每个实体在联系中的角色。联系角色可以用在任何度的联系中，但联系角色的作用通常体现在一元联系中。我们用写在联系连线旁边的文本来表示联系角色。图2-29展示了一些带有特定联系角色的一元联系的例子。
 
图2-29中的各图可以做如下额外解释。
 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042609607.png">

* 图2-29中，例A的解释如下：
  + 一个客户可以是推荐者，推荐多个客户。该客户也可以不是推荐者。
  + 一个客户可以是被推荐者，且只能被一个客户推荐。该客户也可以不是被推荐者。
* 图2-29中，例B的解释如下：
  + 一个雇员可以是指导者，指导多个雇员，也可以不是指导者。
  + 一个雇员可以是被指导者，被多个雇员指导，也可以不是被指导者。
* 图2-29中，例C的解释如下：
  + 一个人必须是礼物赠送者，且只能向一个人赠送礼物。
  + 一个人必须是礼物接受者，且只能接受一个人的礼物。

图2-30展示了一个二元联系中联系角色的例子。
 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042637118.png">
 
正如前文中提到的，ER图建模者可以任意使用联系角色。在某些情况下，联系角色能够使问题变得清晰，然而过度使用联系角色会产生重复问题。例如，在图2-30中，有一定经验的读者不需要显式地通过联系角色来理解联系“Ships”的含义。因此，不标明联系角色的ER图将提供同样的信息，并且更加简明。

# 相同实体间的多种联系
ER图中，相同实体之间通过多种联系连接起来的情况是很常见的。图2-31展示了这种情况。该例子基于如下需求：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618042901891.png">

1. 一个船运公司要创建一个数据库以记录它的雇员信息和包裹信息。
1. 每个包裹只能由一个雇员分拣。
1. 每个雇员可以分拣多个包裹。
1. 每个包裹只能由一个雇员递送。
1. 每个雇员可以递送多个包裹。

# 弱实体
通常情况下，实体至少要有一个唯一属性。在ER图中，弱实体（week entity）用来表示没有唯一属性的实体。弱实体是用双框的矩形表示的。在ER图中，弱实体必须和它的属主实体（owner identity）通过标识性联系（identifying relationship）连接起来。该联系是用双框的菱形表示的。
 
图2-32展示了一个弱实体的例子。该例子基于如下需求：
1. 一个公寓出租公司要创建一个数据库以记录它的建筑物信息和公寓房间信息。
1. 对于每个建筑物，将记录唯一的建筑物ID和该建筑物的层数。
1. 对于每套公寓，将记录公寓编号和公寓内的房间数。
1. 每个建筑物内有多套公寓，每套公寓只能位于一个建筑物内。
 
在我们的数据库中，多套公寓可以有相同的公寓编号，但在一个建筑物内每套公寓只能有一个唯一的公寓编号。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043156954.png">

正如需求中描述的，实体APARTMENT没有唯一属性。然而，在每个建筑物内部，公寓编号是唯一的，这种属性叫做部分码（partial key），在ER图中用下划虚线表示。部分码和属主实体的唯一属性的组合可以唯一标识弱实体的每个实例。例如，弱实体APARTMENT的实例可以由它的部分码AptNo和属主实体BUILDING的主码BuildingID唯一标识，如下所示：
 
A 101，A 201，A 301，B 101，B 201，C 101，C 102，C 201
 
事实上，弱实体的概念和多值复合属性的概念很相似。图2-33说明了这一点。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043221220.png">

图2-33中的两个ER图都满足同样的数据库需求。然而弱实体符号能描述部分码，而多值复合属性则不能。例如，图2-33上半部分的ER图中，我们能显式地说明一个建筑物内的公寓编号是唯一的，而图2-33下半部分的ER图则不能。
 
一个弱实体和其他实体之间可以有普通（非标识性的）联系，而多值复合属性则不能表现这种联系。图2-34展示了一个弱实体参与非标识性联系的例子。
 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043244525.png">

尽管弱实体和多值复合属性有很多相似之处，然而，正如前文所述，这两个概念之间还是有显著区别的。
 
每个弱实体在和其主实体之间的标识性联系中总存在强制的一基数约束，用以确保每个弱实体的实例只和属主实体的一个实例发生关联。另一方面，属主实体可以强制性或选择性地参与到标识性联系中。也就是说，属主实体中的实例可以不与任何弱实体中的实例发生
关联。
 
大多数情况下，标识性联系都是1∶M的联系。然而，也会出现1∶1联系的情况，在这种情况下，弱实体中的部分码就不必作为标识属性了。图2-35说明了这种情况。该例子基于如下需求：
 
1. 数据库将记录雇员以及他们的配偶信息。
1. 对于每个雇员，将记录他的唯一ID和姓名。
1. 对于每个配偶，将记录他的姓名和出生日期。
1. 每个雇员可以有一个配偶或者没有配偶。
1. 每个配偶只能和一个雇员结婚。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043308343.png">

需要注意的是，弱实体SPOUSE不需要部分标识，因为每个雇员只能和一个配偶相关联，因此不需要部分标识来区别不同的配偶。

# 实体、属性和联系的命名约定
在ER建模的过程中，采取特定的准则来为实体、联系和属性命名是一个很好的做法。在本书中，我们约定：使用大写字母来命名实体，使用大写字母和小写字母的组合来命名属性和联系。

对于命名实体和属性，一个常见的准则是使用单数（不使用复数）名词以使ER图尽量清晰易读。例如，实体名STUDENT、STORE和PROJECT要比STUDENTS、STORES和PROJECTS更好。同样，属性名Phone要比属性名Phones好，尽管它是一个多值属性。实体和多值属性都有多个实例，这点从概念本身就能理解，并不需要使用一个复数形式的词来说明。
 
对于命名联系，通常是使用动词或动词短语而不是名词。例如，用Inspects、Manages和BelongsTo来命名联系是比Inspection、Management和Belonging更好的选择。
 
当命名实体、属性和联系时，建议尽量简洁但又不要太过简略而使概念模糊不清。例如，在一个大学的ER图中，实体名STUDENT要比实体名UNIVERSITY STUDENT更好。在上下文环境中，很显然STUDENT是指大学学生，因此UNIVERSITY STUDENT就有些冗长了。同样，使用US作为“University Student”的缩写对于将来使用该数据库的一般用户来说又太过隐晦了。这并不是说使用多个单词或者缩写总是不好的选择。例如，SSN就是一个很好的属性名，因为大家都知道它是社会安全号码的缩写。而使用多个单词的短语NoOfFloors命名属性则是比单个单词Floor或者缩写NoF更好的选择，因为使用Floor会产生歧义，大多数用户也都不会理解NoF的含义。
 
正如本章开始所提到的，ER建模的一条基本规则是同一个实体内的属性必须有不同的名称。而ER建模中一个良好的规则是使整个ER图中的属性名均不相同。例如，不要使用单词Name表示两个不同实体EMPLOYEE和CUSTOMER的两个不同属性，而应该使用不同的单词，如EmpName和CustName。
 
这里提到的准则都不是强制性的，并且会有例外的情况。然而，如果始终遵守这些准则，这样得到的ER图通常会比不使用这些准则得到的ER图更加清晰易读。

# 多个ER图
在一个ER图中，每个实体总能通过直接或间接的联系连接到其他所有实体。换句话说，在每个ER图中，每两个实体之间总会有一条路径。
 
如果一个ER模式包含不能互相连接的实体，实际上，这个ER模式表示了多个单独数据库的ER图。例如，图2-36中，实体A、B、C与实体D、E、F、G不相连。因此，实体A、B、C属于一个ER图的组成部分，而实体D、E、F、G属于另一个ER图的组成部分。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043900695.png">

总的来说，当描述多个ER图时，每个图应该分开表示。不要采用图2-36的方式，一个模式中包含两个ER图，更好的选择是如图2-37所示，单独呈现每个ER图。这可消除由于没有注意到模式包含多个（不相连的）ER图而造成的混淆。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043926684.png">

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618043946371.png">

# 实例：另一组数据库需求及其ER图
复习一下已经介绍过的ER模型的概念，请看图2-38中另一个ER图的例子。该例子基于以下需求：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618044353315.png">

HAFH（Home Away from Home）房地产公司向企业客户提供公寓出租业务。HAFH房地产公司地产数据库将记录HAFH的建筑物、公寓、企业客户、建筑物管理员、清洁工成员和建筑物检查员的信息。
 
房地产公司HAFH的地产数据库将记录以下数据：
 
* 对于每个建筑物：BuildingID（唯一）和BNoOfFloors（建筑物内的楼层数）。
* 对于每套公寓：AptNo（部分唯一，即在一个建筑物内唯一）和ANoOfBedrooms（公寓内的房间数）。
* 对于每个企业客户：CCID（唯一）、CCName（唯一）、CCLocation和CCIndustry。
* 对于每个建筑物管理员：ManagerID（唯一）、MFullName（由MFName和MLName组合形。成）、多个MPhones、MBDate、MAge（由MBDate和当前日期生成）、MSalary和MBonus（不是每个管理员都有奖金）。
* 对于每个清洁工成员：SMemberID（唯一）和SMemberName。
* 对于每个检查员：InsID（唯一）和InsName。
1. 每个建筑物内有一套或多套公寓。每套公寓只位于一个建筑物内。
1. 每套公寓要么只出租给一个企业客户，要么没有出租。每个企业客户可以租用一套或多套公寓。
1. 每个企业客户可以推荐许多企业客户也可以不推荐任何企业客户。每个企业客户只能被一个企业客户推荐或者不被任何企业客户推荐。
1. 每套公寓由一个或两个清洁工负责清理。每个清洁工负责清理5～10套公寓。
1. 每个建筑物管理员管理一个或多个建筑物。每个建筑物只能由一个管理员管理。
1. 每个管理员只能住在一个建筑物内。每个建筑物内要么有一个管理员居住，要么没有管理员居住。
1. 每个检查员检查一个或多个建筑物。每个建筑物可以有一个或多个检查员。
1. 对于某个检查员检查的建筑物，将记录该检查员上次检查该建筑物的日期以及下次将要检查的日期。

# 数据库需求和ER模型的使用
ER建模为收集、构建和可视化数据库需求提供了一种简明易懂的技术。理解ER建模不仅对基于需求构建ER模型是很重要的，并且对需求收集的过程本身也很重要。它有助于我们为建立实体、属性和联系的相关事实而提出正确的问题或找到相应的答案。
 
初学者第一次使用ER建模时常犯的错误是不能区分实体和ER图本身。例如，考虑下面一组简单的需求：
1. 公司X记录其部门以及从属于部门的雇员信息。
1. 每个雇员只能属于一个部门。
1. 每个部门可以有多个雇员，也可以没有雇员。
图2-39的上半部分展示了一个基于该需求的错误ER图的例子。该例表明，将该公司描述成一个实体是错误的，这样该实体将只有一个实例（公司X），这是不必要的，它会使ER图本身变得复杂。相反，基于以上一组需求的ER图只需分为两个简单的实体：雇员和部门，见图2-39的下半部分。不是用一个实体表示公司X，而是用整个ER图（两个实体以及它们之间的联系）表示公司X。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618045155373.png">

注意，如果上述需求的第一条变为一个行业协会想要记录其成员公司、部门以及雇员，这时图2-39上半部分的图就是正确的。然而，需求中明确说明了这是一个公司记录其雇员和部门的数据库，因此，图2-39下半部分的图对于该需求是正确的。
 
为了进一步说明这一点，考虑图2-40中的ER图。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618045224479.png">

图2-40对于以下需求是正确的：
 
1. 一个非盈利的基金会记录它所资助的奖学金获得者。
1. 对于每名学生（奖学金获得者），记录他的唯一学生ID、姓名以及他就读大学的入学日期。
1. 对于每一所拥有该基金会资助学生的大学，基金会记录该大学唯一的大学名称和大学的地理位置。
1. 每一名奖学金获得者只能就读于一所大学。数据库中的每所大学至少有一名奖学金获得者。
 
注意，图2-40中的ER图对于只记录一所大学的数据库是不正确的。在这种情况下，实体COLLEGE是不必要的，就像图2-39中的实体COMPANY一样。
 
另一个数据库需求收集和ER建模中常见的新手错误是不区分以下两者：
 
对需要被记录的数据建模。
 
对发生在一个组织内的所有事情建模。
 
例如，下面的一组需求就没有区分这两者：
 
1. 航空公司X想记录航班、航班空乘人员和乘客信息。
1. 每个航班配备多名空乘人员。每名空乘人员可以配备到多个航班。
1. 每位乘客可以乘坐多个航班。每个航班载有多位乘客。
1. 每名空乘人员可以为多位乘客服务。每位乘客可以由多名空乘人员服务。

图2-41上半部分展示了一个基于以上需求的ER图。这些需求都准确地表示了航空公司X，但问题在于这些需求没有考虑到什么是可能和/或有必要记录的数据。这组需求的前三条是合理的，而最后一条有问题。的确，乘客可以由多名空乘人员服务，每名空乘人员也可为多位乘客提供服务。然而，我们很可能不会真的想要记录所有空乘人员为乘客提供服务的组合。即使我们真的想要记录这些信息，也需要考虑这样做的代价和实用性。在这个例子中，如果我们想要实现一种机制以记录每名空乘人员第一次为某旅客服务的信息（如拿饮料、回答问题等），很可能这种机制将会代价过高且没有意义。因此，需求的最后一条应该删除，删除后的数据库需求如下：
 
1. 航空公司X想记录航班、航班空乘人员和乘客信息。
1. 每个航班配备多名空乘人员。每名空乘人员可以配备到多个航班。
1. 每位乘客可以乘坐多个航班。每个航班载有多名乘客。
1. 因此，应该如图2-41的下半部分所示来构建ER图。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618045256923.png">

# 各种ER符号体系
正如前文所提到的，现在没有一个所有数据库工程都遵守的且被普遍接受的ER符号体系。
 
相反，目前常用的ER符号体系有许多种。然而，如果设计者熟悉某一种ER符号体系，那么掌握其他的ER符号体系则会很容易。
 
图2-42用三种不同的符号体系说明了同样的ER图。图2-42顶部的图使用本书的符号体系来表示ER图。
 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618045428182.png">

图2-42中间的图使用了另一种符号体系。在该符号体系中，属性名和实体名放在同一个矩形内，联系用连接实体的虚线表示，联系名嵌入该虚线中。基数约束用括号内的一对数表示，但基数约束是反过来的（与本书所用的符号体系相比）。解释联系的规则是实体–基数约束–联系–实体。例如，实体EMPLOYEE的每个实例只和实体DEPARTMENT的实例参与到联系ReportsTo中一次，而实体DEPARTMENT的每个实例可以和实体EMPLOYEE的实例0次或多次参与到联系ReportsTo中。
 
图2-42底部的图使用UML（Unified Modeling Language）符号体系来表示同样的ER图。该符号体系中实体和联系的表示方法和中间图的表示方法很相似，但基数约束的解释方法和顶部的图是一样的。如果最小基数是可选的，则用两个点分开的数字表示；如果是强制的，则只用一个数字表示。
 
除了这里已经列出来的ER符号体系，还有许多其他的ER符号体系。幸运的是，它们都描述了同样的概念：实体、联系和属性。熟悉这些概念的开发者能很快适应任何ER符号体系。

# 扩展的ER模型
扩展的ER模型（enhanced ER，EER）是对ER符号体系的扩充，可以描述标准ER模型之外的一些概念。附录A给出了一个EER的简要总结。尽管EER对传统ER概念的扩展有时会很有用，但大多数业务数据库都可以使用本章介绍的ER符号来建模。如果有需要，一个有经验的ER建模者能够很容易地学习和应用EER扩展。
 
# 问题说明：相同实体之间具有多个实例的M∶N联系
在某些情况下，M∶N联系可以在相关实体的相同实例之间多次出现。下面的例子说明了这种情况。观察以下需求：
 
1. 数据库将记录学生和课程信息。
1. 对于每名学生，将记录他的唯一学生ID和姓名。
1. 对于每门课程，将记录唯一的课程ID和课程等级。
1. 数据库中的每名学生可以选修多门课程，也可以不选修任何课程。
1. 数据库中的每门课程至少要被一名学生选修。
1. 对于每个选修某一门课程的学生实例，将记录该学生本门课程的成绩和学期。
 
图2-43展示了一个基于这些需求的ER图。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012222206.png"> 

图2-44展示了图2-43中联系的几个可能的实例。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012250579.png">

如果我们在上面的需求中增加一条很小但很重要的需求，这将会彻底改变M∶N联系的性质：
 
* 一名学生可以多次选修同一门课程（例如，如果一名学生该课程的成绩低于最低成绩要求，他需要重选该课程，直到达到最低成绩要求）。
 
这条增加的需求，可允许实体的相同实例之间的联系具有多个联系实例。如图2-45所示，Pat选修了课程IS101三次。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012316910.png">

这种扩展的需求不能用一个M∶N联系描述。如图2-46所示，我们将使用有两个主实体的弱实体。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012341512.png">

我们使用弱实体的原因是使属性Semester成为一个部分标识符。这样，即使某学生多次选修一门课程的成绩相同，也能通过属性Semester区分同一学生多次选修的同一门课程。例如，假设一个学生多次选择一门课程，每次的成绩都是D，最终，他重选该课程并且以成绩C通过了该课程。
 
当使用弱实体表示一个M∶N联系时，弱实体的基数约束总是强制为1，M∶N联系的基数约束被转移到相应的非弱实体上。考虑图2-43和图2-46。在图2-43中，联系STUDENT Completes CLASS与图2-46中的联系STUDENT Achieves COMPLETION相对应，它们都是可选的最大基数为多个的联系。同样，图2-43中的联系CLASS Completed by STUDENT与图2-46中的联系CLASS Contains COMPLETION相对应，它们都是强制性的最大基数为多个的联系。
 
图2-47展示了另外一个相同实体的多个实例之间具有M∶N联系的例子，使用弱实体表示该联系。这个例子的需求如下：
 
1. 一个汽车出租公司想要记录它的车辆和租用车辆的顾客信息。
1. 对于每位顾客，将记录他的唯一ID和姓名。
1. 对于每辆汽车，将记录它的唯一的VIN和品牌。
1. 一位顾客可以租用多辆汽车，但至少要租用一辆。一辆汽车可以被许多顾客租用，但是也会有车辆从未被租用过。
1. 每次一位顾客租用一辆汽车，将记录租车日期、租用时间和租用一天的价格。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012412289.png">
 
注意，如果我们增加一条很小但很重要的需求：
 
* 每当一位顾客租用一辆汽车时，这次出租都会有一个唯一的出租ID。
 
那么得到的ER图应该如图2-48所示。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012436382.png">

既然每次出租都有一个唯一属性，那么我们就不必用弱实体表示出租，而是用一个普通实体来表示它。
 
正如图2-48的例子所展示的，在需求中为一个M∶N联系（尤其是具有多个属性的M∶N联系）增加一个唯一标识属性，将会把这个M∶N联系转换成一个普通实体。采用这种方式来简化ER图以及后续的结果数据库是一种很常用的技术。

# 问题说明：关联实体
关联实体（associated entity）是一种概念，是用于描述M∶N联系的替代方式之一。关联实体用一个内部有菱形的矩形来表示。关联实体没有唯一或部分唯一的属性，且通常没有任何属性。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012859900.png">

图2-49展示了一个M∶N联系以及其用关联实体替代的形式。在图2-49中，上、下两图是相互等价的，且是根据完全相同的需求来设计的。只要联系AssignedtTo没有属性，则这个相应的关联实体ASSIGNMENT也没有属性。

在图2-49的上图中，实体EMPLOYEE是可选择性参与到联系AssignedTo中的。相应地，在图2-49下图所示与其等价的关联实体ASSIGNMENT中，实体EMPLOYEE也是可选择性参与到联系Includes中的。另一方面，在图2-49上图中，实体PROJECT是强制参与到联系AssignedTo中的。相应地，在图2-49下图所示与其等价的关联实体ASSIGNMENT中，实体PROJECT也是强制参与到联系IsFor中的。同时需要注意的是，关联实体自身的基数约束在两种联系中都是强制唯一的(一般来说这是关联实体的问题)。
 
图2-50展示了一个一元M∶N联系以及其用关联实体表示的替代形式。

在图2-50中，上、下两图是相互等价的，且是根据完全相同的需求设计的。
 
图2-51展示的是带一个属性的M∶N联系以及其用关联实体表示的替代形式。

在图2-51中，上、下两图是相互等价的，且是根据完全相同的需求设计的。在上图中，只要联系SoldVia有一个属性NoOfItems，则在相应的下图中，其等价的关联实体LINEITEM同样有一个属性NoOfItems。每一次销售事务可以包含多个不同数量的产品，如上图所示。因此，在下图中，每一次销售事务可以有多个项目行，每一个项目行代表在一次销售事务中销售了某种产品及其销售数量。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619012935702.png">

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619013000234.png">

关联实体并不是描述二元或一元联系的必需结构。正如上面的例子所展示的那样，对于二元或一元联系而言，关联实体仅仅是另一种描述联系的方式。若不用关联实体，同样可以很容易地描述这种联系。但正如下一小节所述，对那些度大于2的联系（如三元联系）而言，关联实体则提供了一种消除ER图中潜在歧义的方法。

# 问题说明：三元（及更高阶）联系
一个度为3的联系，包含3个实体，也称为三元联系（ternary relationship）。本书将利用下面的例子来展示三元联系。
 
MG (Manufacturing Guru) 公司想要记录它的供应商、零部件和产品。
 
特别地，MG公司想要记录哪家供应商提供了哪些零部件给哪类产品。在需求收集的过程中，MG提供了下列具体需求：
 
1. 我公司有多类产品。
1. 我公司有多家供应商。
1. 我公司有多类零部件。
1. 我公司想要记录哪家供应商提供了哪些零部件给哪类产品。
1. 每类产品包含一个或多个零部件，每一零部件有一家或多家供应商供应。
1. 每一家供应商可以提供多种零部件给多类产品，但是也可不提供任何零部件给任何产品。
1. 每一类零部件可以被一家或多家供应商提供给一类或多类产品。
 
简单地在这三个实体之间创建三个二元联系并不能完整地描述以上需求。图2-52展示了三个联系，分别表示：哪类产品与哪些供应商有关联，哪家供应商与哪些零部件有关联，哪种零部件与哪些产品有关联（为简单起见，这部分中所有实体都没有带属性）。但是，基于图2-52创建的数据库并不能记录哪家供应商提供了哪些零部件给哪类产品。
 
<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014412951.png">

比如，基于图2-52创建的数据库，我们可以描述供应商A1和A2是零部件B的供应方，同时，零部件B是产品C 的零部件之一。但是，假设供应商A1为产品C供应零部件B，供应商A2没有为产品C供应零部件B（即供应商A2供应零部件B，但是不为产品C 提供零部件B），则以图2-52为基础建立的数据库就不能描述这样一个场景。
 
为了涵盖所有可能的合理应用场景，所有三个实体都必须统一集中于一种联系，这样就得到了一个三元联系。
 
三元联系的一个棘手问题是在某一种三元联系中，不能明确地表示基数限制。图2-53中展示了一种包含实体SUPPLIER、PRODUCT和COMPONENT的三元联系Provides，图中没有给出基数限制的原因是无法毫无歧义地标明基数限制。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014441750.png">

在图2-53中，对那些没有为任何产品提供任何零部件的供应商，图中并没有清楚表示我们可以在什么地方放置记录这些供应商的符号。若只是在联系的零部件一侧设置一个可选符号，这样虽然简洁但依然存在歧义：究竟是希望记录那些不为任何产品提供任何零部件的供应商，还是希望记录那些没有任何供应商为其提供任何零部件的产品。
 
换句话说，这种表示方式根本不能清楚地描述一个联系的基数。但是，如图2-54所示，如果用关联实体来替代的话，就可以清楚地描述三元联系的所有可能的基数限制了。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014504793.png">

注意，图2-54描述了哪家供应商为哪类产品提供了哪些零部件。如果我们要为供应商记录下产品零部件的实际交付量，则需要增加额外的属性，如数量。但是，在图2-54所示的关联实体中仅简单地为供应商增加数量（quantity）这一属性也无法解决上述问题，因为同一家供应商可以不止一次地为同一产品提供同等数量的同一零部件。如果只增加数量这个属性，就没有办法唯一区分同一家供应商为同一产品提供等数量的同一零部件的不同实例。对这一情况的解决办法之一是创建另一属性作为一个唯一交付标识。如果给这些需求增加一项规定，对于每一供应商为某一特定产品供应特定零部件，都认为是一个单独的个体交付并且有自己独特的交付标识，这样一来，就不需要用关联实体来表示了，而是可以用图2-55所示的常规实体来表示。
 
三元联系中还需要注意的是，除了少数例外情况，三元联系适用于绝大多数像多对多对多（many-to-many-to-many）这样的联系。图2-56展示了一个多对多对一（many-to-many-one）的三元联系。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014530290.png">

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014608125.png">

图2-56表示每一零部件都是由某一家供应商专门为某一产品供应的。因此，此图可以简化成如图2-57，从而消除了转化成三元关系的必要性。

<img src="http://www.2cto.com/uploadfile/2015/0619/20150619014639318.png">

但是，值得注意的是，若想记录实际的各种交易及其数量，还是不得不使用图2-55，除非联系IsIncluded是1∶1的。
 
在实际中，三元联系比较少见，度大于3的联系更为少见。在多数情况下，当设计者试图创建度大于2的联系时，往往会尝试创建额外的实体而非联系。


# Example
<img src="http://www.2cto.com/uploadfile/2015/0619/20150619015200195.png">
<img src="http://www.2cto.com/uploadfile/2015/0619/20150619015223788.png">
<img src="http://www.2cto.com/uploadfile/2015/0619/20150619015247395.png">

















