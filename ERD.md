<img src="http://www.2cto.com/uploadfile/2015/0618/20150618022140928.png">

关系数据库模型是DBMS软件组成部分的基础。DBMS软件包用于实现目前大多数的操作型和分析型数据库。
关系DBMS软件包括Oracle、MySQL、Microsoft SQL Server、PostgreSQL、IBM DB2以及Teradata。
在这些DBMS工具中，Teradata适用于大型分析型数据库，其他的DBMS可同时用于操作型数据库和分析型数据库。


## ER 建模基本构建
ER建模后得到的ER图（ER diagram，ERD）是整个数据库的蓝图。实体(entity)和联系(relationship)是ER图的两个基本构件。目前还没有一个所有数据库都遵循的通用ER符号体系。相反，当前采用的ER符号体系种类繁多。虽然采用来自不同符号体系的ER符号来表示实体和联系时差异巨大，但其含义通常是相同的。

## 实体
实体是ER图的基本组件，用于描述数据库所记录的内容。实体可以表示现实世界中的众多概念，如人、地点、对象、事件、项目等。例如，一个零售公司的ER图可能包含顾客（CUSTOMER）、商店（STORE）、产品（PRODUCT）和交易额（SALES TRANSACTION）四个实体。
 
ER图用矩形代表实体，实体名写在矩形里面，同一个ER图中的不同实体应该有不同名字。图2-1展示了CUSTOMER及STORE两个实体的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618034900418.png">

图2-1中每个实体包含多个实体实例/实体成员（entity instance/entity member），如实体CUSTOMER可能包含Joe、Sue、Pat等实例。实体本身需要画在ER图中，实体实例虽然不需要表示在ER图中，但会被记录到根据该ER图所创建的数据库之中

## 属性(唯一和非唯一)
ER图中每个实体都有属性，实体的一个属性描述该实体的一种特征。由于实体表示的是数据库所记录内容的组件，因而实体属性表示每个实例需要记录的细节。例如，对实体CUSTOMER可以记录以下属性：编号（CustID）、姓名（CustName）、生日（CustBDate）、性别（CustGender）。图2-2描述了如何将属性填入ER图中：每个属性由一个写有属性名字的椭圆表示，同一个实体的不同属性名字不同，每个椭圆用一条线连接到相应实体。唯一属性（unique attribute）是指可以唯一标识实体实例的属性。通常来说一个实体至少要有一个唯一属性。如图2-2所示，ER图中实体的唯一属性都带有下划线。该图所示的数据库需求表明，每个顾客的编号必须唯一，但两个或多个顾客的生日、姓名或性别则可以相同。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035422489.png">

## 联系
ER图中每个实体必须通过联系至少与一个其他实体相关联。在ER图中联系表示为一个菱形，菱形中间写有代表联系名字的词或短语，菱形与所有参与该联系的实体进行连线。
### 基数约束 Cardinality Constraint
ER图中，在实体与联系的连线上往往写有一些符号，这些符号就是基数约束（cardinality constraint）。基数约束用于表示该实体可以有多少实例与另一实体的实例存在联系。考虑图2-3中的ER图，菱形“ReportsTo”表示实体EMPLOYEE和实体DEPARTMENT之间的联系。而表示基数约束的符号则常常写于实体和联系之间靠近实体一端的连线上。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035234234.pnghttp://www.2cto.com/uploadfile/2015/0618/20150618035234234.png">

每个基数约束包含以下两个部分：
* 最大基数（maximum cardinality）——靠近实体一端的基数约束部分；
* 最小基数/参与（minimum cardinality/participation）——远离实体一端的基数约束部分。
* 最大基数可以是一个（表示为“|”）或多个（表示为“?”）。
* 最小基数可以是可选的（表示为“0”）或者是强制的（表示为“|”）。

图2-4列出了实体A与联系B之间所有四种可能的基数约束。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035259565.png">

接下来将以图2-3中包含关系ReprotsTo的ER图为例说明基数约束的概念。以下是
图2-3中ER图的基本需求：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035325223.png">

1. 数据库将记录职员（employee）和部门（department）信息。
1. 对每个职员记录其姓名及唯一职员编号（employeeID）。
1. 对每个部门记录其唯一部门编号（departmentID）和位置。
1. 每个职员必须且只能为一个部门作报告。一个部门可以有许多职员为其报告，但也可以没有任何职员。

首先考虑图2-3中ReprotsTo菱形右侧的基数约束符号“||”。强制参与符号（本例中的左侧竖线）表示每个职员必须至少为一个部门作报告。换言之，关系ReortsTo的EMPLOYEE实体的最大基数约束是1。最大基数约束符号一个（本例中的右侧竖线）表示每个职员至多可以为一个部门作报告。因此，这两个符号放在一起，表示每个职员必须且只能为一个部门作报告。

接下来考虑ReportsTo菱形左侧的基数约束符号“?0”。可选参与符号（0）表示部门可以没有职员来作报告，换言之，ReportsTo关系中的DEPARTMENT实体的最小基数约束是0，最大基数约束多个（?）表示一个部门可能有多个职员来作报告。因此，这两个符号放在一起表示每个部门可以有多个职员来作报告，但也可以没有。换言之，一个部门最少有0个职员，最多有多个职员。
 
注意，解释ER图中联系的合理方法，是利用**矩形–菱形–基数约束–矩形**规则分别**从相反方向分两次**来考虑这个关系。例如，联系ReportsTo就可以解释成：
 
* 一个方向：**矩形（职员）–菱形（作报告）–基数约束（有且仅有一个）–矩形（部门）**；
 
* 另一个方向：**矩形（部门）–菱形（接受报告）–基数约束（从0到多个）–矩形（职员）**。
 
为进一步重申关系和基数约束的概念，本书接下来将在图2-5中给出ReportsTo联系的几种可能版本（为简洁起见，省略了实体属性）。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035325223.png">

以下是每个版本的需求:
* 版本A：每个职员必须且只能为一个部门作报告。一个部门可能同时有多个职员作报告，也可能没有。
* 版本B：一个职员可以为一个或者不为任何部门作报告。一个部门可以同时有多个职员作报告，也可能没有任何职员。
* 版本C：每个职员必须且只能为一个部门作报告。一个部门必须有至少一个职员作报告，也可以同时有多个职员。
* 版本D：一个职员可以为一个或者不为任何部门作报告。一个部门必须有至少一个职员作报告，也可以同时有多个职员。

## 联系类型（最大基数侧）
联系两侧的最大基数约束可为一个或者多个。因此，若不考虑最小基数而仅考虑最大基数，则联系共有以下几种情况：
 
* 一对一联系（1∶1）
* 一对多联系（1∶M)
* 多对多联系（M∶N)
图2-6给出了这三种类型的联系及其最大基数侧（由于最小基数不影响最大基数，为简明起见，将其省略）。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035532647.png">

图2-3和2-5给出了1∶M联系的例子。图2-7的例子同样也是1∶M联系，该联系反映了如下需求：
 
每个商店（store）必须且只能位于一个区域（region）。每个区域内至少要有一个商店，当然也可以有多个商店。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035551529.png">

图2-8给出了一个M∶N联系的例子，反映的需求如下：
 
一个职员（employee）可能分配了多个项目（project），但也可能一个项目也没有。一个项目至少应分配给一个职员，当然也可以分给多个职员共同完成。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035615931.png">

图2-9给出了一个1∶1联系，反映的需求如下：
 
每个职员（employee）要么分有一辆车（vehicle），要么一辆也没有。每辆车必须且只能分给一个职员。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035636846.png">

## 联系和联系实例
每个实体都有自己的实例，如实体EMPLOYEE可能有实例Bob、Lisa、Maria等。实体本身需要画在ER图中，实体实例虽然不需要表示在ER图中，但会被记录到根据该ER图所创建的数据库之中。与此类似，联系也有自己的实例。图2-10给出了一个联系及其实例的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035739547.png">

如图2-10所示，当一个实体的实例通过联系与另一个实体的实例相关联时，一个联系实例就产生了。就像实体和实体实例的情况一样，联系本身会被画进ER图，联系实例则不需要表示在ER图中，但会被记录到根据该ER图所创建的数据库中。
 
注意，图2-10中的实体EMPLOYEE在联系AssignedTo中为可选参与，所以才可能存在职员（如Matt）与右边所有项目都不相连的情况。而由于PROJECE实体在联系AssignedTo中为强制参与，因此每一个PROJECT的实例都必须至少与一个EMPLOYEE实体的实例存在连线。

## 联系属性
在许多情况下，多对多联系有自己的属性，这些属性就是联系属性（relationship attributes）。图2-11给出了一个例子，该ER图的需求如下：
1. 数据库将记录学生（students）和校园组织（campus organizations）信息。
1. 对每个学生记录其唯一学号（student ID）、姓名（name）及性别（gender）。
1. 对每个校园组织记录其唯一组织编号（organization ID）和位置（location）。
1. 数据库中每个学生必须至少属于一个校园组织，也可以同时属于多个组织。
1. 数据库中每个校园组织至少有一个学生加入其中，也可以同时拥有多个学生。
1. 对属于某个校园组织的每个具体的学生实例，记录该学生在该校园组织中的职能（function）（如主席、副主席、会计、成员等）。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035902659.png">

上面的最后一条需求表明，一个学生在不同的校园组织中可以有多个不同的职能。若将职能作为实体STUDENT的一个或多个属性，则无法知道某个职能是该学生在哪个社会组织中的职能。若将职能作为ORGANIZATION的一个或多个属性，又无法知道该社会组织的某职能具体由哪个学生来担任。因此，如图2-11所示，职能属性唯一恰当的位置是作为BelongsTo联系的属性。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618035923173.png">

接下来讨论1∶1联系与1∶M联系是否也可以拥有属性。为了回答这个问题，图2-12给出了两个有细微差别的ER图，这两个图的需求如下：
 
1. 数据库记录学生（student）和学院（college）信息。
1. 对每个学生记录其姓名和唯一学号（student ID）。
1. 对每个学院记录其唯一名称（name）和位置（location）。
1. 每个学生必须且只能加入一个学院。
1. 每个学院有多个学生。
1. 对每个学生记录其注册进入学院的日期。
 
图2-12的上半部分给出了1∶M联系的一个属性。下半部分基于同样的需求，但将学生的注册日期作为实体STUDENT的属性StudentCollSdate，而不是作为联系Attends的属性DateStarted。由于一个学生只能加入一个学院，因此该学生加入该学院的日期可以作为STUDENT实体本身的一个属性。如本例所述，1∶M联系的一个属性可转化为在该联系中最大基数为1的实体属性（本例中的STUDENT）。**更一般地讲，联系属性可以转化为在该联系中最大基数为1的实体属性**。因此，**1∶M联系或1∶1联系的属性都不是必要的。**相反，如图2-11所示，对一些M∶N联系来说，属性则是必要的。

## 实例：数据库需求集及其ER图
下面这些与零售相关的实例都是数据库需求及其对应ER图的例子。
 
ZAGI零售公司的销售部门准备创建一个数据库来记录销售过程的细节。在访问公司并学习了公司文件以后，数据库团队抽取出了如下需求。
 
ZAGI零售公司销售部门数据库将收集如下数据：
 
* 对每个在售产品（product）：产品号(product ID)（唯一）、产品名称（product name）、价格（price）；
* 对每个种类（category）：种类号（category ID）（唯一）、种类名称（category name）；
* 对每个自动售货机（vendor）：售货机号（vendor ID）（唯一）、售货机名称（vendor name）；
* 对每位顾客（customer）：顾客号（customer ID）（唯一）、姓名（name）、邮政编码（zip code）；
* 对每个商店（store）：商店号（store ID）（唯一）、邮政编码（zip code）；
* 对每个区域（region）：区域号（region ID）（唯一）、区域名称（region name）；
* 对每项销售交易（sales transaction）：交易号（transaction ID）（唯一）、交易时间（date of transaction）。
1. 每个产品必须且只能由一个售货机供应；
1. 每个售货机可以包含一个或多个产品。
1. 每个产品必须且只能属于一个种类；
1. 每个种类可以包含一个或多个产品。
1. 每个商店必须且只能位于一个区域；
1. 每个区域可以包含一个或多个商店。
1. 每项销售交易只能出现在一个商店中；
1. 每个商店可以有一项或多项销售交易发生。
1. 每项销售交易必须且只能跟一位顾客相关；
1. 每位顾客可以与一项或多项销售交易相关。
1. 每个产品可以通过一项或多项销售交易售出；
1. 每项销售交易可以包含一个或多个产品。
1. 对于每个通过销售交易售出的产品实例，记录其售出的数量。
2. 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041003396.png"> 

图2-13给出了基于以上需求得到的ER图。注意，ER符号体系的知识，能够为数据库需求收集人员获得结构化的、有用的需求提供帮助。换言之， ER图的构建必须以完成数据库需求搜集过程为基础，认清这一点可以帮助数据库需求收集人员提出恰当的问题。下面列出了几个相应问题的例子（来自图2-13中ER图的需求搜集过程）：
 
对一位顾客，你最想记录什么信息？（顾客号、姓名及邮政编码）
 
每位顾客的顾客号是否唯一？（是的）
 
每位顾客的姓名是否唯一？（不是）
 
一个产品属于一个种类还是多个？（一个）
 
一个产品是否只能来自一个售货机？（是的）
 
是否曾经有过某售货机不提供任何产品的情况？（没有）
 
是否需要记录那些到目前为止没有买过任何商品的顾客（那些没有参与任何销售交易的顾客）？（不需要）

## 复合属性 Composite Attribute

除前文中提到的常规属性外，ER图还可以描述几种其他属性，复合属性（composite attribute）就是其中的一种。复合属性是若干属性的组合，图2-14就给出了一个复合属性的例子。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041125811.png">

在图2-14中，属性CustFullName（顾客全名）由两个部分组成：属性CustFName（顾客名字）和属性CustLName（顾客姓氏）。复合属性用于表示由若干单个属性组成的属性集合拥有新含义的情况。在图2-14中，实体CUSTOMER有5个属性：编号（CustID）（描述顾客信息的唯一标识号）、性别（CustGender）、生日（CustBdate）、名字（CustFName）、姓氏（CustLName）。全名并不是实体CUSTOMER的额外属性，相反，它仅仅表示将名字和姓氏结合起来以后所得到的完整的顾客姓名。
 
图2-15给出了另一个复合属性的例子。实体STORE共有6个属性，每个属性都有自己的意义。若将属性街道（Street）、编号（StreetNumber）、城市（City）、州（State）、邮编（Zip）放在一起考虑，则可得到一个新的含义：商店地址（Store Address）。
 
图2-16给出了包含7个属性的BOUTIQUECLIENT实体的例子。这家独具一格的裁缝店记录了每位顾客的尺寸信息及顾客的名字（firstname）。同时，该裁缝店还记录了顾客的5种穿衣指数：腿长（inseam）、腰围（waist）、袖长（sleeves）、肩宽（shoulders）以及领围（collar）。这个例子说明一个简单属性可能是多个复合属性的组成部分。腿长及腰围可组成属性裤子尺寸（pantsize），而腰围、肩宽、领围及袖长可组成属性衬衣尺寸（shirtsize）。
 
<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041151368.png">

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041151368.png">

## 复合的唯一属性
图2-17给出了拥有复合的唯一属性（composite unique attribute）的实体例子。在图2-17中，教学楼（Building）、房间号（Room Number）、座位数（Number of seats）是实体CLASSROOM的三个属性，但它们都不唯一。CLASSROOM实体的需求表示如下：

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041258877.png">

1. 同一栋教学楼中可以有多个教室（如A教学楼中有若干个教室）。
1. 可以有多个教室拥有相同的房间号（如A教学楼的111房间与B教学楼的 111房间）。
1. 可以有多个教室拥有相同的座位数（如若干个教室都有40个座位）。
 
由于三个属性都不唯一，所以CLASSROOM没有一个可以唯一标识其本身的简单属性（single-component）。然而教学楼和房间号两个属性的结合却是唯一的（因为在整个数据库中，给定教学楼和房间号可以确定唯一教室），因此，这两个属性组成的复合属性可以作为唯一属性。
 
复合属性ClassroomID使得实体CLASSROOM符合每个实体至少要有一个唯一属性的规则。

## 多个唯一属性（候选码）
图2-18给出的实体同时拥有多个唯一属性，这里的每个唯一属性就叫做一个候选码（candidate key）。“候选”的意义在于：这些属性都可作为构建整个数据库时主要区别属性（或称主码）的备选。换言之，这些候选码中的一个会成为表中该实体的主码。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041403640.png"> 

在图2-18中，属性EmpID和SSN都可以区分一个EMPLOYEE实体，因此两者都是EMPLOYEE的候选码。所有候选码都有下划线标识。属性薪水（Salary）并不唯一，因此不是候选码。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041431736.png">
 
一个实体可以同时将常规属性（单个复合属性）或复合属性作为主码。图2-19中，实体VEHICLE的属性VIN（vehicle identification number）是唯一的，同样，State和LPNumber组合起来的复合属性LPlate也是唯一的。

# 多值属性 multivalued attribute
多值属性（multivalued attribute）用于实体实例的同一属性可以有多个不同取值的情况。图2-20给出了一个有多值属性的实体例子，标识多值属性的椭圆外画有双线。图2-20中的ER图需要记录用户的多个电话号码。
 
多值属性用于那些属性取值多于一个的实体，图2-20就是这样的情景：对于每个职员，需要记录若干个联系电话。例如，某职员可能有两个联系电话，而有些职员可能有多于两个的联系电话，或是少于两个的联系电话。
 
如图2-21所示，若对每个职员都记录两个联系电话（办公室电话和手机），则不需要使用多值属性，只要分别使用两个单值属性就可以了。

<img src="http://www.2cto.com/uploadfile/2015/0618/20150618041530661.png">










 



